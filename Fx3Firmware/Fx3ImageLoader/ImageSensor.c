/*
 * ImageSensor.c
 *
 *  Created on: May 6, 2022
 *      Author: ShenL
 */
#include "cyu3system.h"
#include "cyu3os.h"
#include "cyu3dma.h"
#include "cyu3error.h"
#include "cyu3usb.h"
#include "cyu3i2c.h"
#include "cyu3spi.h"
#include "cyu3uart.h"
#include "ControlEndpointMarco.h"
#include "cyu3utils.h"

typedef uint8_t u8;
u8 ReadBuffer [1];
u8 WriteBuffer[1];

CyU3PReturnStatus_t
CyImageSensorSpiTransfer (
        uint16_t  startAddress, // register offset address
        uint16_t  byteCount,
        uint8_t  *buffer,
        CyBool_t  isRead,
        CyBool_t  isSlave)
{
	       uint8_t overHead[2];
	       CyU3PReturnStatus_t status = CY_U3P_SUCCESS;
	       overHead[0] = startAddress & 0xFF; // Chip ID
	       overHead[1] = (startAddress >> 8) & 0xFF; //address

	        if (isRead)
	        {
	            overHead[0] = overHead[0] + 0x80;  /* Read command. */

	            CyFxSpiSetSsnLine1 (CyFalse, isSlave);
	            status = CyFxSpiTransmitWords (overHead, 2);
	            if (status != CY_U3P_SUCCESS)
	            {
	                CyU3PDebugPrint (2, "SPI READ command failed\r\n");
	                CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	                return status;
	            }

	            status = CyFxSpiReceiveWords (buffer, byteCount);
	            if (status != CY_U3P_SUCCESS)
	            {
	                CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	                return status;
	            }

	            CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	        }
	        else /* Write */
	        {
	        	CyFxSpiSetSsnLine1 (CyFalse, isSlave);
	            status = CyFxSpiTransmitWords (overHead, 2);
	            if (status != CY_U3P_SUCCESS)
	            {
	                CyU3PDebugPrint (2, "SPI WRITE command failed\r\n");
	                CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	                return status;
	            }

	            status = CyFxSpiTransmitWords (buffer, byteCount);
	            if (status != CY_U3P_SUCCESS)
	            {
	                CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	                return status;
	            }

	            CyFxSpiSetSsnLine1 (CyTrue, isSlave);
	        }

	    CyU3PThreadSleep (5);
	    return CY_U3P_SUCCESS;

}

CyU3PReturnStatus_t SPI_WriteReg (uint16_t regAddr, uint8_t value){
	CyU3PReturnStatus_t status = CY_U3P_SUCCESS;
	WriteBuffer [0] = (u8)(value & 0xff);
	status = CyImageSensorSpiTransfer (regAddr, 1, WriteBuffer, CyFalse, CyFalse);
	status = CyImageSensorSpiTransfer (regAddr, 1, WriteBuffer, CyFalse, CyTrue);
	return status;
}

CyU3PReturnStatus_t InitImageSensor_FRAMOS(){

	// image sensor clock setting INCK = 74.25MHz
	SPI_WriteReg(0x1402, 0xA);
	SPI_WriteReg(0x1502, 0x22);
	SPI_WriteReg(0x1602, 0xB1);
	SPI_WriteReg(0x1802, 0x3F);
	SPI_WriteReg(0x1902, 0x4);
	SPI_WriteReg(0x1B02, 0x3A);
	// VMAX
	SPI_WriteReg(0xD402, 0xB2);
	SPI_WriteReg(0xD502, 0x12);
	SPI_WriteReg(0xD602, 0x0);
	// HMAX
	SPI_WriteReg(0xD802, 0xD1);
	SPI_WriteReg(0xD902, 0xE);
	//SPI_WriteReg(0xD902, 0x0);
	// GMRWT
	SPI_WriteReg(0xE202, 0x8);
	// GMTWT
	SPI_WriteReg(0xE302, 0x14);
	// GAINDLY
	SPI_WriteReg(0xE502, 0x4);
	// GSDLY
	SPI_WriteReg(0xE602, 0x20);
    // ADBIT = 12
  	SPI_WriteReg(0x4, 0x14);
  	// ODBIT = 12
	SPI_WriteReg(0x3006, 0x1);
	// Set Sequential Trigger Mode
	SPI_WriteReg(0x0006, 0x9);

	SPI_WriteReg(0xD08, 0xF);
	SPI_WriteReg(0x1008, 0xFF);
	SPI_WriteReg(0x3304, 0x0);
	SPI_WriteReg(0xAC04, 0x4B);
	SPI_WriteReg(0x805, 0x4A);

	SPI_WriteReg(0x4405, 0xF);
	SPI_WriteReg(0x4505, 0x0);
	SPI_WriteReg(0x4605, 0x14);
	SPI_WriteReg(0x4805, 0xF);
	SPI_WriteReg(0x4905, 0x0);
	SPI_WriteReg(0x4A05, 0x14);
	SPI_WriteReg(0x4C05, 0xF);
	SPI_WriteReg(0x4D05, 0x0);
	SPI_WriteReg(0x4E05, 0x14);
	SPI_WriteReg(0x6405, 0xF);
	SPI_WriteReg(0x6505, 0x0);
	SPI_WriteReg(0x6605, 0x14);
	SPI_WriteReg(0x6805, 0xF);
	SPI_WriteReg(0x6905, 0x0);
	SPI_WriteReg(0x6A05, 0x14);
	SPI_WriteReg(0x6C05, 0xF);
	SPI_WriteReg(0x6D05, 0x0);
	SPI_WriteReg(0x6E05, 0x14);

	SPI_WriteReg(0x3507, 0x0);
	SPI_WriteReg(0x4207, 0x27);
	SPI_WriteReg(0x4A07, 0x20);
	SPI_WriteReg(0x9C07, 0x0);
	SPI_WriteReg(0xA407, 0x96);
	SPI_WriteReg(0xA807, 0x96);
	// BLKLEVEL
	SPI_WriteReg(0xB407, 0x0);
	SPI_WriteReg(0xBE07, 0x62);
	SPI_WriteReg(0xCA07, 0x15);
	SPI_WriteReg(0xCE07, 0x15);
	SPI_WriteReg(0xEC07, 0x96);
	SPI_WriteReg(0xF007, 0xFB);
	SPI_WriteReg(0xF107, 0xB);
	SPI_WriteReg(0xF207, 0xFB);
	SPI_WriteReg(0xF307, 0xB);

	SPI_WriteReg(0x8, 0x55);
	SPI_WriteReg(0xC08, 0xD);
	SPI_WriteReg(0x1208, 0x0);
	SPI_WriteReg(0x3008, 0x5E);
	SPI_WriteReg(0x3208, 0x17);
	SPI_WriteReg(0x3408, 0xE0);
	SPI_WriteReg(0x3508, 0x1);
	SPI_WriteReg(0x3608, 0xDC);
	SPI_WriteReg(0x3708, 0x1F);
	SPI_WriteReg(0x3808, 0x76);
	SPI_WriteReg(0x3908, 0x2);
	SPI_WriteReg(0x3C08, 0x1C);
	SPI_WriteReg(0x3E08, 0xEB);
	SPI_WriteReg(0x3F08, 0x1F);
	SPI_WriteReg(0x4008, 0x0);
	SPI_WriteReg(0x4208, 0x0);
	SPI_WriteReg(0x4308, 0x0);
	SPI_WriteReg(0x4408, 0x0);
	SPI_WriteReg(0x4608, 0x0);
	SPI_WriteReg(0x4708, 0x0);
	SPI_WriteReg(0x4808, 0x0);
	SPI_WriteReg(0x4908, 0x0);
	SPI_WriteReg(0x4A08, 0x0);
	SPI_WriteReg(0x4B08, 0x0);
	SPI_WriteReg(0x4C08, 0x0);
	SPI_WriteReg(0x4E08, 0x0);
	SPI_WriteReg(0x4F08, 0x0);
	SPI_WriteReg(0x5808, 0x5E);
	SPI_WriteReg(0x5A08, 0x17);
	SPI_WriteReg(0x5C08, 0xE0);
	SPI_WriteReg(0x5D08, 0x1);
	SPI_WriteReg(0x5E08, 0xEE);
	SPI_WriteReg(0x5F08, 0x1F);
	SPI_WriteReg(0x6008, 0x4F);
	SPI_WriteReg(0x6108, 0x2);
	SPI_WriteReg(0x6208, 0x8F);
	SPI_WriteReg(0x6408, 0x1C);
	SPI_WriteReg(0x6608, 0xEB);
	SPI_WriteReg(0x6708, 0x1F);
	SPI_WriteReg(0x6808, 0xCC);
	SPI_WriteReg(0x6A08, 0xFA);
	SPI_WriteReg(0x6B08, 0x1F);
	SPI_WriteReg(0x6C08, 0xF5);
	SPI_WriteReg(0x6E08, 0xF5);
	SPI_WriteReg(0x6F08, 0x1F);
	SPI_WriteReg(0x7008, 0x33);
	SPI_WriteReg(0x7108, 0x2);
	SPI_WriteReg(0x7208, 0xF5);
	SPI_WriteReg(0x7308, 0x1F);
	SPI_WriteReg(0x7408, 0x0);
	SPI_WriteReg(0x7608, 0x0);
	SPI_WriteReg(0x7708, 0x0);
	SPI_WriteReg(0x8008, 0x5E);
	SPI_WriteReg(0x8208, 0x17);
	SPI_WriteReg(0x8408, 0xE0);
	SPI_WriteReg(0x8508, 0x1);
	SPI_WriteReg(0x8608, 0xDC);
	SPI_WriteReg(0x8808, 0x50);
	SPI_WriteReg(0x8908, 0x2);
	SPI_WriteReg(0x8A08, 0xE5);
	SPI_WriteReg(0x8B08, 0x1F);
	SPI_WriteReg(0x8C08, 0x1C);
	SPI_WriteReg(0x8E08, 0xEB);
	SPI_WriteReg(0x8F08, 0x1F);
	SPI_WriteReg(0x9C08, 0x0);
	SPI_WriteReg(0x9E08, 0x0);
	SPI_WriteReg(0x9F08, 0x0);
	SPI_WriteReg(0xE408, 0x0);
	SPI_WriteReg(0xE808, 0x17);
	SPI_WriteReg(0xF008, 0x2C);
	SPI_WriteReg(0xF108, 0x1);

	SPI_WriteReg(0x520B, 0x8);
	SPI_WriteReg(0x530B, 0x8);
	SPI_WriteReg(0xC0C, 0x18);

	SPI_WriteReg(0x2E10, 0x3B);
	SPI_WriteReg(0x3010, 0x85);
	SPI_WriteReg(0x6E10, 0x3B);
	SPI_WriteReg(0x7010, 0x6E);
	SPI_WriteReg(0x8E10, 0xA3);
	SPI_WriteReg(0x9010, 0xDB);
	SPI_WriteReg(0x9610, 0x1);
	SPI_WriteReg(0x9810, 0x37);
	SPI_WriteReg(0x9E10, 0x71);
	SPI_WriteReg(0xA010, 0x82);
	SPI_WriteReg(0xBE10, 0xDC);

	SPI_WriteReg(0x3C11, 0x2E);
	SPI_WriteReg(0x4411, 0xC8);
	SPI_WriteReg(0x8411, 0xC5);
	SPI_WriteReg(0xA211, 0x1C);
	SPI_WriteReg(0xA411, 0x5B);
	SPI_WriteReg(0xA611, 0xA3);

	SPI_WriteReg(0x4612, 0xA3);
	SPI_WriteReg(0x9812, 0x39);
	SPI_WriteReg(0xB612, 0x1C);
	SPI_WriteReg(0xB812, 0x6F);
	SPI_WriteReg(0xC812, 0x2C);
	SPI_WriteReg(0xC912, 0x1);
	SPI_WriteReg(0xCA12, 0xC8);
	SPI_WriteReg(0xCB12, 0x1);
	SPI_WriteReg(0xD812, 0x2C);
	SPI_WriteReg(0xD912, 0x1);
	SPI_WriteReg(0xDA12, 0xC8);
	SPI_WriteReg(0xDB12, 0x1);

	SPI_WriteReg(0x7A13, 0xA2);
	SPI_WriteReg(0x8213, 0x0);
	SPI_WriteReg(0x8413, 0x38);
	SPI_WriteReg(0xA413, 0x2F);
	SPI_WriteReg(0xBA13, 0x1B);
	SPI_WriteReg(0xBC13, 0x5C);
	SPI_WriteReg(0xBE13, 0xA2);
	SPI_WriteReg(0xEA13, 0xA2);

	SPI_WriteReg(0xE14, 0x1B);
	SPI_WriteReg(0x1014, 0x70);
	SPI_WriteReg(0x3214, 0xC);
	SPI_WriteReg(0x3514, 0x21);
	SPI_WriteReg(0x3714, 0xC);
	SPI_WriteReg(0xE414, 0xFF);
	SPI_WriteReg(0xE514, 0xF);
	SPI_WriteReg(0xE614, 0x0);
	SPI_WriteReg(0xE714, 0x0);
	SPI_WriteReg(0xF614, 0x89);
	SPI_WriteReg(0xF714, 0x2);

	SPI_WriteReg(0x615, 0x0);
	SPI_WriteReg(0x715, 0x0);
	SPI_WriteReg(0x815, 0x0);
	SPI_WriteReg(0x915, 0x0);
	SPI_WriteReg(0x1015, 0x4);
	SPI_WriteReg(0x1115, 0x4);
	SPI_WriteReg(0x1215, 0x4);
	SPI_WriteReg(0x1315, 0x4);
	SPI_WriteReg(0x1E15, 0x14);
	SPI_WriteReg(0x1F15, 0x14);
	SPI_WriteReg(0x3C15, 0x8A);
	SPI_WriteReg(0x3D15, 0x2);
	SPI_WriteReg(0x3E15, 0xE8);
	SPI_WriteReg(0x3F15, 0x5);
	SPI_WriteReg(0x4015, 0x9E);
	SPI_WriteReg(0x4115, 0xC);
	SPI_WriteReg(0x7015, 0x2C);
	SPI_WriteReg(0x7115, 0x1);
	SPI_WriteReg(0x7215, 0xC8);
	SPI_WriteReg(0x7315, 0x1);
	SPI_WriteReg(0x8015, 0x2C);
	SPI_WriteReg(0x8115, 0x1);
	SPI_WriteReg(0x8215, 0xC8);
	SPI_WriteReg(0x8315, 0x1);

	SPI_WriteReg(0x5E16, 0x2C);
	SPI_WriteReg(0x5F16, 0x1);
	SPI_WriteReg(0x6016, 0xC8);
	SPI_WriteReg(0x6116, 0x1);
	SPI_WriteReg(0x6716, 0x83);
	SPI_WriteReg(0x6816, 0xCC);
	SPI_WriteReg(0x6916, 0x2);
	SPI_WriteReg(0x6A16, 0x58);
	SPI_WriteReg(0x6E16, 0x5F);
	SPI_WriteReg(0x7216, 0x64);
	SPI_WriteReg(0x7616, 0xC6);
	SPI_WriteReg(0x7A16, 0xC6);
	SPI_WriteReg(0x7E16, 0xC6);
	SPI_WriteReg(0x8216, 0xC6);
	SPI_WriteReg(0x8616, 0xC6);
	SPI_WriteReg(0x8A16, 0x58);
	SPI_WriteReg(0x8E16, 0x5F);
	SPI_WriteReg(0x9216, 0x64);
	SPI_WriteReg(0x9616, 0xC6);
	SPI_WriteReg(0x9A16, 0xC6);
	SPI_WriteReg(0x9E16, 0xC6);
	SPI_WriteReg(0xA216, 0xC6);
	SPI_WriteReg(0xA616, 0xC6);
	SPI_WriteReg(0xEC16, 0x4B);
	SPI_WriteReg(0xF016, 0x52);
	SPI_WriteReg(0xF416, 0x57);
	SPI_WriteReg(0xF816, 0xB9);

	SPI_WriteReg(0x17, 0xB9);
	SPI_WriteReg(0x417, 0xB9);
	SPI_WriteReg(0x817, 0xB9);
	SPI_WriteReg(0xC17, 0xB9);
	SPI_WriteReg(0x1017, 0x4B);
	SPI_WriteReg(0x1417, 0x52);
	SPI_WriteReg(0x1817, 0x57);
	SPI_WriteReg(0x1C17, 0xB9);
	SPI_WriteReg(0x2017, 0xB9);
	SPI_WriteReg(0x2417, 0xB9);
	SPI_WriteReg(0x2817, 0xB9);
	SPI_WriteReg(0x2C17, 0xB9);
	SPI_WriteReg(0x7617, 0xF2);
	SPI_WriteReg(0x7817, 0xDE);
	SPI_WriteReg(0x7A17, 0x30);
	SPI_WriteReg(0x7C17, 0x1C);
	SPI_WriteReg(0x7D17, 0x2);
	SPI_WriteReg(0x7E17, 0xE0);
	SPI_WriteReg(0x8017, 0xF0);
	SPI_WriteReg(0x8217, 0x1E);
	SPI_WriteReg(0x8417, 0x2E);
	SPI_WriteReg(0x8817, 0xF4);
	SPI_WriteReg(0x8C17, 0x32);
	SPI_WriteReg(0x9817, 0xE3);
	SPI_WriteReg(0xAE17, 0xE);
	SPI_WriteReg(0xAF17, 0x0);
	SPI_WriteReg(0xB017, 0x8D);
	SPI_WriteReg(0xB117, 0x2);
	SPI_WriteReg(0xB617, 0xE);
	SPI_WriteReg(0xB717, 0x0);
	SPI_WriteReg(0xB817, 0x8D);
	SPI_WriteReg(0xB917, 0x2);
	SPI_WriteReg(0xCE17, 0x18);
	SPI_WriteReg(0xCF17, 0x0);
	SPI_WriteReg(0xD017, 0x8D);
	SPI_WriteReg(0xD117, 0x2);
	SPI_WriteReg(0xD617, 0x18);
	SPI_WriteReg(0xD717, 0x0);
	SPI_WriteReg(0xD817, 0x8D);
	SPI_WriteReg(0xD917, 0x2);
	SPI_WriteReg(0xE617, 0x53);
	SPI_WriteReg(0xF017, 0x90);
	SPI_WriteReg(0xF217, 0x8A);
	SPI_WriteReg(0xF817, 0x8E);
	SPI_WriteReg(0xFA17, 0x90);

	SPI_WriteReg(0x418, 0x8E);
	SPI_WriteReg(0x618, 0x90);
	SPI_WriteReg(0xC18, 0x8A);
	SPI_WriteReg(0xE18, 0xBB);
	SPI_WriteReg(0x1418, 0x90);
	SPI_WriteReg(0x1618, 0x8A);
	SPI_WriteReg(0x3418, 0x4A);
	SPI_WriteReg(0x3618, 0x90);
	SPI_WriteReg(0x3C18, 0x4C);
	SPI_WriteReg(0x3E18, 0x92);
	SPI_WriteReg(0x4418, 0x4E);
	SPI_WriteReg(0x4618, 0x94);
	SPI_WriteReg(0x4C18, 0x47);
	SPI_WriteReg(0x4E18, 0x4D);
	SPI_WriteReg(0x5418, 0x49);
	SPI_WriteReg(0x5618, 0x50);
	SPI_WriteReg(0x5C18, 0x4B);
	SPI_WriteReg(0x5E18, 0x52);
	SPI_WriteReg(0x6A18, 0x9E);
	SPI_WriteReg(0x7018, 0x98);
	SPI_WriteReg(0x7618, 0x96);
	SPI_WriteReg(0x7818, 0xBA);
	SPI_WriteReg(0x9818, 0x93);
	SPI_WriteReg(0x9A18, 0xB9);
	SPI_WriteReg(0xA018, 0x67);
	SPI_WriteReg(0xA218, 0x8D);
	SPI_WriteReg(0xF618, 0xE1);

	SPI_WriteReg(0x819, 0xE5);
	SPI_WriteReg(0xA19, 0xE1);
	SPI_WriteReg(0x1019, 0x23);
	SPI_WriteReg(0x1219, 0x1F);
	SPI_WriteReg(0x1819, 0x6D);
	SPI_WriteReg(0x2219, 0x6D);
	SPI_WriteReg(0x2819, 0x34);
	SPI_WriteReg(0x2919, 0xE);
	SPI_WriteReg(0x2A19, 0x8A);
	SPI_WriteReg(0x2B19, 0xE);
	SPI_WriteReg(0x2C19, 0xE1);
	SPI_WriteReg(0x2D19, 0xE);
	SPI_WriteReg(0x2E19, 0x6);
	SPI_WriteReg(0x3019, 0x4);
	SPI_WriteReg(0x3119, 0x4);
	SPI_WriteReg(0x3C19, 0x6);
	SPI_WriteReg(0x3E19, 0x4);
	SPI_WriteReg(0x3F19, 0x4);
	SPI_WriteReg(0x4419, 0x20);
	SPI_WriteReg(0x4519, 0xA);
	SPI_WriteReg(0x4619, 0xF4);
	SPI_WriteReg(0x4719, 0xC);
	SPI_WriteReg(0x4819, 0x3A);
	SPI_WriteReg(0x4919, 0x9E);
	SPI_WriteReg(0x4A19, 0xCA);
	SPI_WriteReg(0x4B19, 0xE);
	SPI_WriteReg(0x5319, 0x90);
	SPI_WriteReg(0x5419, 0xCA);
	SPI_WriteReg(0x5519, 0xE);
	SPI_WriteReg(0x5A19, 0x53);
	SPI_WriteReg(0x5B19, 0xA);
	SPI_WriteReg(0x5C19, 0xFB);
	SPI_WriteReg(0x5D19, 0xFB);
	SPI_WriteReg(0x6419, 0xDC);
	SPI_WriteReg(0x6519, 0xFE);
	SPI_WriteReg(0x6819, 0xDC);
	SPI_WriteReg(0x6919, 0xFE);
	SPI_WriteReg(0x7019, 0x6D);
	SPI_WriteReg(0x7619, 0x6D);
	SPI_WriteReg(0x8019, 0x1F);
	SPI_WriteReg(0x8719, 0x8F);
	SPI_WriteReg(0x8819, 0x4);
	SPI_WriteReg(0xA319, 0xC);
	SPI_WriteReg(0xA419, 0x80);
	SPI_WriteReg(0xD519, 0x3F);
	SPI_WriteReg(0xF719, 0xF2);

	SPI_WriteReg(0x641A, 0x20);
	SPI_WriteReg(0x681A, 0x21);
	SPI_WriteReg(0x6C1A, 0x22);
	SPI_WriteReg(0x741A, 0x20);
	SPI_WriteReg(0x781A, 0x21);
	SPI_WriteReg(0x7C1A, 0x22);
	SPI_WriteReg(0xA41A, 0x83);
	SPI_WriteReg(0xA81A, 0x84);
	SPI_WriteReg(0xAC1A, 0x85);
	SPI_WriteReg(0xB41A, 0x83);
	SPI_WriteReg(0xB81A, 0x84);
	SPI_WriteReg(0xBC1A, 0x85);

	SPI_WriteReg(0x1C04, 0x80);
	SPI_WriteReg(0x1D04, 0x5);
	SPI_WriteReg(0x1E04, 0xE0);
	SPI_WriteReg(0x1F04, 0x0);
	SPI_WriteReg(0x2004, 0x80);
	SPI_WriteReg(0x2104, 0x5);
	SPI_WriteReg(0x2204, 0xE0);
	SPI_WriteReg(0x2304, 0x0);
	SPI_WriteReg(0x2404, 0x10);
	SPI_WriteReg(0x2504, 0x14);
	SPI_WriteReg(0x2604, 0x20);
	SPI_WriteReg(0x2704, 0xC0);
	SPI_WriteReg(0x4004, 0x58);
	SPI_WriteReg(0x4104, 0x0);
	SPI_WriteReg(0x4204, 0x0);
    // XHS XVS setting
	SPI_WriteReg(0x3C06, 0xF0);
	SPI_WriteReg(0x207, 0x9);
	 // BLK level
	SPI_WriteReg(0xB407, 0x0);
	SPI_WriteReg(0xB507, 0x0);
    // IDLECODE1
	SPI_WriteReg(0x340B, 0x3C);
	SPI_WriteReg(0x350B, 0x1);
	// IDLECODE2
	SPI_WriteReg(0x360B, 0xBC);
	SPI_WriteReg(0x370B, 0x1);
	// IDLECODE3
	SPI_WriteReg(0x380B, 0x3C);
	SPI_WriteReg(0x390B, 0x1);
	// IDLECODE4
	SPI_WriteReg(0x3A0B, 0x3C);
	SPI_WriteReg(0x3B0B, 0x1);

	SPI_WriteReg(0xC0C, 0x18);
	SPI_WriteReg(0xC, 0xD1);
    // overlap ROI mode
	SPI_WriteReg(0x3, 0x0);
	// horizontal  setting
	SPI_WriteReg(0x403, 0x3);
	// vertical  setting
	SPI_WriteReg(0x503, 0x0);
	// horizontal and vertical cropping
	SPI_WriteReg(0x2003, 0xF0);
	SPI_WriteReg(0x2103, 0x2);
	SPI_WriteReg(0x2203, 0xD0);
	SPI_WriteReg(0x2303, 0x4);
	SPI_WriteReg(0x2403, 0x0);
	SPI_WriteReg(0x2503, 0xF);
	SPI_WriteReg(0x2603, 0x70);
	SPI_WriteReg(0x2703, 0x8);
    // VOPB effective area
	SPI_WriteReg(0xD002, 0x0);
	SPI_WriteReg(0xD102, 0xF);
    // standby cancel
	SPI_WriteReg(0x2, 0x0);
	// set gain: 256 = 0x100
	SPI_WriteReg(0x1407,0x00);
	SPI_WriteReg(0x1507,0x1);

	return CY_U3P_SUCCESS;
}



